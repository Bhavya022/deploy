<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <style>
      /* All Your css for Home page goes here  */ 
      #menu-container{
        display: grid; 
        grid-template-columns: repeat(4,1fr); 
        width: 90%; 
        margin: auto; 
        gap: auto;
      } 
      img{
        width: 100%;
      } 
      
    </style>
  </head>

  <body>
    <div class="nav">
      <h1>Web Coffee Shop Menu</h1>
      <a href="./index.html">Home</a>
      <a href="./order.html">Ordered</a>
    </div>
    <div id="filter">
      <input type="number" id="lower" />
      <input type="number" id="upper" />
      <button id="filter-btn">Filter</button>
    </div>
    <select id="sort">
      <option value="">Sort By Price</option>
      <option value="asc">Ascending</option>
      <option value="desc">Descending</option>
    </select>
    <h1 id="alert"></h1>
    <div id="menu-container">
      <!-- Here Append All the Items  -->  

    </div>
  </body>
  <script> 
  let container = document.getElementById("menu-container")  
  let lower = document.getElementById("lower").value 
  let upper = document.getElementById("upper").value
  let filterbtn = document.getElementById("filter-btn") 
  let h1 = document.getElementById("alert")
    // All your JS code for Home Page goes here
    const url = `https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-coffee`;
  fetch(url) 
  .then((res)=>{
   return res.json()
  })  
  .then((res)=>{
    console.log(res.data); 
    fetchData=res.data
    displayProducts(res.data)
  }) 
  .catch((error)=>{
    console.log(error);
  })   
  
  function displayProducts(data){
    data.forEach(element => {
      let card = document.createElement("div")  
     let img = document.createElement("img") 
     img.setAttribute("src",element.image);
     let name = document.createElement("h2") 
     name.innerText = element.title; 
     let ing = document.createElement("p") 
     ing.innerText = element.ingredients; 
     let des = document.createElement("p") 
     des.innerText = element.description ;
     let price = document.createElement("h3") 
     price.innerText= element.price; 
     let buy = document.createElement("button") 
     buy.innerText="Buy"; 
     buy.addEventListener("click",()=>{
      let cartData = JSON.parse(localStorage.getItem("buy")) 
      if(cartData===null){
        cartData =[]; 
      }   
      let isAlready = false;
      for(let i=0;i<cartData.length;i++){
        if(cartData[i].id===element.id){
          isAlready = true; 
          break;
        }
      }   
      if(isAlready === true){
        h1.innerText="Already Placed Order."
      } 
      else{
        h1.innerText="Successfully Placed Order"
      }
      cartData.push(element);
      localStorage.setItem("buy",JSON.stringify(cartData))
     })
     card.append(img,name,ing,des,price,buy)
      container.append(card) 

    });   }
    let fetchData =[] 
    function fetchAndRenderCoffee(url){
      fetch(url) 
      .then((res)=>res.json()) 
      .then(data=>{
        fetchData= data.data.map((ele)=>{
          id:ele.id,
          name:ele.title,
          desc:ele.des.substring(0,75),
          price:ele.price,
          image:`${ele.image}`,
          ingredients:ele.ing[0] 
        })
      })
    }
    let filter = document.getElementById("filter") 
    filterbtn.addEventListener("click",()=>{
     let filtered = fetchData.filter((element)=>{ 
      console.log(lower,upper) 
      if(element.price>=lower && element.price<=upper){
        return element;
      } 
      
     }) 
     renderCoffee(filter)
    })  
    function renderCoffee(fetchData){
     let coffeeList=`
     <div id="cardList">
       ${fetchData.map((ele)=>{
        getcard(
          ele.id,
          ele.name,
          ele.des,
          ele.price,
          ele.image,
          ele.ing
        )
       }
       ).join('')}
      </div>
     `  
     
    }
    
    function getcard(id,name,price,image,ingredients){
     let card=`
     <div id="card">
      <img src=${image} alt="coffee"/>
      <h3>${name}</h3> 
      <p>${ing}</p>
      <p>${des}</p>
      <p>${price}</p>
      <button>Buy</button>
      </div>
     ` 
    }
    
    // function fetch(){
    //   let promise = fetch(url) 
    //   promise.then((res)=>{
    //     return res.json()
    //   }) 
    //   .then((acctual)=>{

    //   }) 
    //   .catch((error)=>{
    //     console.log((error));
    //   })
    // }  

    let sort = document.getElementById("sort");
    sort.addEventListener("change",(e)=>{
      let selected = e.target.value 
      console.log(selected) 
      if(selected=='asc'){
      container.innerHTML=null 
      let apiInc = 'https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-coffee?sort=price&order=asc' 
      fetch(apiInc)
      } 
      else if(selected=='desc'){
        container.innerHTML=null 
        let apidec ='https://dbioz2ek0e.execute-api.ap-south-1.amazonaws.com/mockapi/get-coffee?sort=price&order=desc' 
        fetch(apidec)
      }
    })
  </script>
</html>
